@model DoctorViewModel

@{
    ViewData["Title"] = "Edit Doctor";
    Guid doctorId = ViewBag.DoctorId; 
}

<h2>Edit Doctor Profile</h2>

@if (ViewBag.ErrorMessage != null)
{
    <div class="alert alert-danger">@ViewBag.ErrorMessage</div>
}

<form asp-action="Edit" asp-route-id="@doctorId" method="post">
    
    <div class="row">
        <div class="col-md-6">
            <h4>Personal Info</h4>
            <div class="form-group">
                <label>Name</label>
                <input asp-for="FirstName" class="form-control" />
            </div>
            <div class="form-group">
                <label>Email</label>
                <input asp-for="Email" class="form-control" />
            </div>
             <div class="form-group">
                <label>LastName</label>
                <input asp-for="LastName" class="form-control" />
            </div>
        </div>
        <div class="col-md-6">
            <h4>Specialist Info</h4>
            <div class="form-group">
                <label>Specialization</label>
                <input asp-for="Specialization" class="form-control" />
            </div>
            <div class="form-group">
                <label>Department</label>
                <input asp-for="Department" class="form-control" />
            </div>
            <div class="form-group">
                <label>Role</label>
                <input asp-for="Role" class="form-control" />
            </div>
            <div class="form-group">
                <label>Experience</label>
                <input asp-for="YearsOfExperience" class="form-control" />
            </div>
        </div>
    </div>

    <hr />

    <h4>Work Schedules</h4>
    <table class="table" id="scheduleTable">
        <thead>
            <tr>
                <th>Day</th>
                <th>Start Time</th>
                <th>End Time</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody id="scheduleBody">
            @for (int i = 0; i < Model.Schedules.Count; i++)
            {
                <tr>
                    <td>
                        <select name="Schedules[@i].Day" class="form-control" asp-for="@Model.Schedules[i].Day">
                            <option value="Saturday">Saturday</option>
                            <option value="Sunday">Sunday</option>
                            <option value="Monday">Monday</option>
                            <option value="Tuesday">Tuesday</option>
                            <option value="Wednesday">Wednesday</option>
                            <option value="Thursday">Thursday</option>
                            <option value="Friday">Friday</option>
                        </select>
                    </td>
                    <td>
                        <input type="time" name="Schedules[@i].StartTime" class="form-control" value="@Model.Schedules[i].StartTime" />
                    </td>
                    <td>
                        <input type="time" name="Schedules[@i].EndTime" class="form-control" value="@Model.Schedules[i].EndTime" />
                    </td>
                    <td>
                        <button type="button" class="btn btn-danger btn-sm" onclick="removeRow(this)">Remove</button>
                    </td>
                </tr>
            }
        </tbody>
    </table>

    <button type="button" class="btn btn-secondary" onclick="addScheduleRow()">+ Add New Shift</button>
    
    <hr />
    <button type="submit" class="btn btn-warning btn-lg">Update Doctor</button>
    <a asp-action="Index" class="btn btn-link">Cancel</a>
    @if (TempData["ErrorMessage"] != null)
{
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
        <strong>Error!</strong> @TempData["ErrorMessage"]
        <button type="button" class="close" data-bs-dismiss="alert" aria-label="Close">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
}
</form>

<script>

    let index = @Model.Schedules.Count;

    function addScheduleRow() {
        const tableBody = document.getElementById("scheduleBody");
        
        const row = `
            <tr>
                <td>
                    <select name="Schedules[${index}].Day" class="form-control">
                        <option>Saturday</option>
                        <option>Sunday</option>
                        <option>Monday</option>
                        <option>Tuesday</option>
                        <option>Wednesday</option>
                        <option>Thursday</option>
                        <option>Friday</option>
                    </select>
                </td>
                <td>
                    <input type="time" name="Schedules[${index}].StartTime" class="form-control" />
                </td>
                <td>
                    <input type="time" name="Schedules[${index}].EndTime" class="form-control" />
                </td>
                <td>
                    <button type="button" class="btn btn-danger btn-sm" onclick="removeRow(this)">Remove</button>
                </td>
            </tr>
        `;

        tableBody.insertAdjacentHTML('beforeend', row);
        index++;
    }
    
    function removeRow(btn) {
        btn.closest('tr').remove();
    }
</script>